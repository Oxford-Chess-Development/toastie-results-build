(this["webpackJsonptoastie-results"]=this["webpackJsonptoastie-results"]||[]).push([[0],{10:function(e,t,n){e.exports={th:"crosstable_th__Gp7TR",round:"crosstable_round__2RGZ-"}},13:function(e,t,n){e.exports={wrapper:"chesscom_wrapper__3vwwR",container:"chesscom_container__AGg5n",boardLabel:"chesscom_boardLabel__1N2Qy",board:"chesscom_board__3LGEQ","fade-in":"chesscom_fade-in__15-gn",row:"chesscom_row__17flm",square:"chesscom_square___JdY5",W:"chesscom_W__1Kbfl",B:"chesscom_B__misXA"}},21:function(e){e.exports=JSON.parse('{"b":"http://localhost:8080/","a":"https://api.oxfordchess.co.uk/","c":true}')},27:function(e,t,n){},40:function(e,t,n){e.exports=n.p+"static/media/watch.ddf443c3.svg"},48:function(e,t,n){e.exports=n(95)},53:function(e,t,n){},95:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),c=n(42),s=n.n(c),o=(n(53),n(45)),u=n(11),i=n(15),l=n(2),m=(n(27),n(20)),d=n.n(m),f=n(21),b=function(){};console.log("isDev",!1);var h=f.a;function p(e){return e=Object.assign(e,{method:"GET"}),d()(e).then((function(e){return e.data})).catch((function(e){var t;throw console.error(e),e.response&&b([e.response.status,e.response.statusText,":","/"+(null===(t=e.response.config.url)||void 0===t?void 0:t.split("/").pop())].join(" ")),e}))}d.a.defaults.baseURL=h;var v=n(4),g=n.n(v),w=n(12),E=n(43),j=n.n(E),O=n(44),y=n.n(O),k=/chess\.com\/(?:live#tm=|club\/matches\/live\/(?:[a-z-]+\/)?)([0-9]+)/,N=n(13),x=n.n(N),_=n(8),S=n(23),R=new y.a({queue:!0});function C(e,t){return L.apply(this,arguments)}function L(){return(L=Object(w.a)(g.a.mark((function e(t,n){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,a){R.dispatch(R.getTeamLiveMatchBoard,(function(t,n){if(n)return a(n);e(t.body)}),[t,n])})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){return W.apply(this,arguments)}function W(){return(W=Object(w.a)(g.a.mark((function e(t){return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){R.dispatch(R.getTeamLiveMatch,(function(t,a){if(a)return n(a);e(t.body)}),[t])})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var M=new Map([["p",r.a.createElement(_.e,null)],["n",r.a.createElement(_.d,null)],["b",r.a.createElement(_.a,null)],["r",r.a.createElement(_.g,null)],["q",r.a.createElement(_.f,null)],["k",r.a.createElement(_.c,null)]]);function D(e){var t=Object(a.useState)(e.enforceBoards||20),n=Object(l.a)(t,2),c=n[0],s=n[1],o=Object(a.useReducer)((function(e,t){var n=e.slice(0);return n[t.board]={boardScores:t.boardScores,game:t.game},n}),[]),u=Object(l.a)(o,2),m=u[0],d=u[1],f=Object(a.useState)(0),b=Object(l.a)(f,2),h=b[0],p=b[1],v=Object(a.useReducer)((function(e,t){return e[t.i]=t.name,e}),["",""]),E=Object(l.a)(v,2),O=E[0],y=E[1],N=Object(a.useReducer)((function(e,t){var n=Object.assign({},e);return n[t.player.username.toLowerCase()]=t.team,n}),{}),R=Object(l.a)(N,2),L=R[0],W=R[1],D=Object(a.useState)(!1),T=Object(l.a)(D,2),B=T[0],F=T[1],I=Object(a.useReducer)((function(e,t){var n=e.slice(0);return n[t.board]=t.set,n}),[]),G=Object(l.a)(I,2),U=G[0],q=G[1],A=Object(a.useCallback)(Object(w.a)(g.a.mark((function t(){var n,a,r,c,o,u;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.matchURL.match(k)){t.next=3;break}return t.abrupt("return",console.error("Invalid URL: ",e.matchURL));case 3:return a=Number(n[1]),t.prev=4,t.next=7,P(a);case 7:for((r=t.sent).boards&&s(r.boards),"finished"!==r.status&&"scheduled"!==r.status||F(!0),c=function(){var e=u[o],t=O.findIndex((function(t){return!t||t===e.name}));y({name:e.name,i:t});var n,a=Object(i.a)(e.players);try{for(a.s();!(n=a.n()).done;){var r=n.value;W({player:r,team:t})}}catch(c){a.e(c)}finally{a.f()}},o=0,u=Object.values(r.teams);o<u.length;o++)c();t.next=17;break;case 14:t.prev=14,t.t0=t.catch(4),console.error(t.t0);case 17:p(a);case 18:case"end":return t.stop()}}),t,null,[[4,14]])}))),[e.matchURL,O]);Object(a.useEffect)((function(){A()}),[A]);var J=Object(a.useCallback)(Object(w.a)(g.a.mark((function t(){var n,a,r;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(h){t.next=2;break}return t.abrupt("return");case 2:if(!B||!m.length){t.next=4;break}return t.abrupt("return");case 4:n=g.a.mark((function t(n){var a;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!U[n]){t.next=2;break}return t.abrupt("return","continue");case 2:if(a=C(h,n).then((function(e){var t=e.games[e.games.length-1];return d({game:t,boardScores:e.board_scores,board:n}),Date.now()>t.end_time&&q({board:n,set:!0}),!0})).catch((function(e){return!e.message.includes("doesn't have board")||(s(n-1),!1)})),c!==(e.enforceBoards||20)){t.next=9;break}return t.next=6,a;case 6:if(t.t0=t.sent,!1!==t.t0){t.next=9;break}return t.abrupt("return","break");case 9:case"end":return t.stop()}}),t)})),a=1;case 6:if(!(a<c+1)){t.next=17;break}return t.delegateYield(n(a),"t0",8);case 8:r=t.t0,t.t1=r,t.next="continue"===t.t1?12:"break"===t.t1?13:14;break;case 12:return t.abrupt("continue",14);case 13:return t.abrupt("break",17);case 14:a++,t.next=6;break;case 17:case"end":return t.stop()}}),t)}))),[h,c,B,U,m.length]);return Object(a.useEffect)((function(){var e=setInterval(J,1e3);return function(){return clearInterval(e)}}),[J]),m.length||c?r.a.createElement("div",{className:x.a.container},m.map((function(e,t){if(!e)return null;var n=Object.entries(e.boardScores),a=e.game,c=L[a.black.username.toLowerCase()],s=r.a.createElement(r.a.Fragment,null,a.white.username," (",a.white.rating,")"," ",r.a.createElement(S.b,null)),o=r.a.createElement(r.a.Fragment,null,a.black.username," (",a.black.rating,")"," ",r.a.createElement(S.a,null));c&&(n=n.reverse());var u=new j.a(a.fen).board;return r.a.createElement("div",{className:x.a.wrapper},r.a.createElement("div",{className:x.a.boardLabel},r.a.createElement("span",{className:"bold"},n[0][1]),r.a.createElement("a",{href:"https://www.chess.com/live/game/"+a.url.split("/").pop(),target:"_blank",rel:"noopener noreferrer"},r.a.createElement(_.b,null)),r.a.createElement("span",{className:"bold"},n[1][1])),r.a.createElement("div",null,c?s:o," ",O[0]),r.a.createElement("div",{className:x.a.board},u.map((function(e){return r.a.createElement("div",{className:x.a.row},e.map((function(e){return r.a.createElement("div",{className:[x.a.square,x.a[(t=e,t.toLowerCase()===t?"B":"W")]].join(" ")},M.get(e.toLowerCase()));var t})))}))),r.a.createElement("div",null,c?o:s," ",O[1]))}))):r.a.createElement("div",null,"Match has not yet started!")}var T=n(40),B=n.n(T);function F(e){var t=Object(a.useState)(""),n=Object(l.a)(t,2),c=n[0],s=n[1],o=e.status.round||0,u=Object(a.useReducer)((function(e,t){var n=Object.assign({},e);return n[t.id]=[t.time,t.players],n}),{}),m=Object(l.a)(u,2),d=m[0],f=m[1],b=Object(a.useCallback)(Object(w.a)(g.a.mark((function t(){var n,a,r;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=Object(i.a)(e.pairings),t.prev=1,r=function(){var t=a.value,n=Object.values(t[2]).find((function(e){return e}));if(!n)return"continue";var r=n.match(k);n=r?"https://www.chess.com/club/matches/live/"+r[1]:"",P(Number(r[1])).then((function(e){return f({id:r[1],time:1e3*e.start_time})})).catch(function(){var t=Object(w.a)(g.a.mark((function t(a){var c;return g.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a.message.includes("not found")){t.next=7;break}return t.next=3,p({url:"/tournament/"+e.id+"/scrapeChessComTeamPage",params:{url:n}});case 3:c=t.sent,f({id:r[1],time:new Date(c["Start Time"]).valueOf(),players:c["Players per Team"]}),t.next=8;break;case 7:console.error(a);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},n.s();case 4:if((a=n.n()).done){t.next=10;break}if("continue"!==r()){t.next=8;break}return t.abrupt("continue",8);case 8:t.next=4;break;case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(1),n.e(t.t0);case 15:return t.prev=15,n.f(),t.finish(15);case 18:case"end":return t.stop()}}),t,null,[[1,12,15,18]])}))),[e.pairings,f]);return Object(a.useEffect)((function(){b()}),[b]),r.a.createElement("section",null,r.a.createElement("p",null,"All times in ",new Date(Date.now()).toString().slice(25)),r.a.createElement("table",{className:"download-table full-width"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("td",{style:{width:"27.5%"}},"White"),r.a.createElement("td",{style:{width:"12.5%"}},"Link"),r.a.createElement("td",{style:{width:"5%"}}),r.a.createElement("td",{style:{width:"10%"}},"Start Time"),r.a.createElement("td",{style:{width:"5%"}}),r.a.createElement("td",{style:{width:"12.5%"}},"Watch Live"),r.a.createElement("td",{style:{width:"27.5%"}},"Black"))),r.a.createElement("tbody",null,e.pairings.map((function(t,n){var a,u,i,l=[t[0].trim(),t[1].trim()].join("."),m=e.playerDict.get(t[0].trim()),f=e.playerDict.get(t[1].trim()),b=Object.values(t[2]).find((function(e){return e})),h=null===(a=b)||void 0===a?void 0:a.match(k);b=h?"https://www.chess.com/club/matches/live/"+h[1]:"";var p=h&&d[h[1]]?d[h[1]][0]:0,v=h&&d[h[1]]?d[h[1]][1]:void 0;return r.a.createElement(r.a.Fragment,null,r.a.createElement("tr",{key:["row",n].join(".")},r.a.createElement("td",null,r.a.createElement("div",{className:"playerName"},null===m||void 0===m?void 0:m.firstName)),r.a.createElement("td",{style:{padding:0}},b?r.a.createElement("a",{className:"button",href:b.trim(),target:"_blank",rel:"noopener noreferrer"},r.a.createElement(_.h,null)):null),r.a.createElement("td",{className:"bold"},null===m||void 0===m||null===(u=m.histories[o])||void 0===u?void 0:u.game),r.a.createElement("td",null,p?new Date(p).toString().slice(0,21):"-"),r.a.createElement("td",{className:"bold"},null===f||void 0===f||null===(i=f.histories[o])||void 0===i?void 0:i.game),r.a.createElement("td",{style:{padding:0}},b?r.a.createElement("div",{className:"button",onClick:function(){return s(c?"":l)}},r.a.createElement("img",{className:"icon",src:B.a,alt:"Watch games"})):null),r.a.createElement("td",null,r.a.createElement("div",{className:"playerName"},null===f||void 0===f?void 0:f.firstName))),b&&c===l?r.a.createElement("tr",null,r.a.createElement("td",{colSpan:100},(t[2].chessComLink||t[2].chessComTeamLink)&&t[2].chessComTeamLink?r.a.createElement(D,{matchURL:t[2].chessComTeamLink,enforceBoards:Number(v)}):null)):null)})))))}var I=n(19),G=n(10),U=n.n(G),q={pre:{id:{name:"",className:"blank",sort:!1,value:function(){return 0},postConvert:function(e,t){return(1+t).toString()}},name:{name:"Name",className:"playerName",id:function(e){return e.id},sort:function(e,t){return e>t?1:e<t?-1:0},value:function(e,t,n){return"individual"===n.competitors?[e.firstName,e.lastName].join(" "):e.firstName}},rating:{name:"Rating",className:"locked",value:function(e){return e.rating},show:function(e,t,n){return n.showRatings}}},roundColumn:{name:function(e,t){return e.slice(-1)},className:function(e,t,n){return"*"===e?"edit":""===e?"unset":"locked"},value:function(){},convert:function(e,t,n){if(""===e)return"";if("*"===e)return"*";var a,r=parseInt(e);return a=.5===r?"\xbd":r.toString(),e.endsWith("b")&&(a+="b"),a},sort:function(e,t){if(e===t)return 0;if(""===e)return-1;if(""===t)return-1;if("*"===e)return 1;if("*"===t)return-1;var n=[parseInt(e),parseInt(t)],a=n[0],r=n[1];return e.endsWith("b")&&(a-=.001),t.endsWith("b")&&(r-=.001),r-a}},post:{score:{name:"MP",className:"locked",value:function(e){return parseFloat(e.score.toString())},convert:function(e,t){return e.toFixed(1)+" / "+t.played}},gamePoints:{name:"GP",className:"locked",value:function(e){return e.gamePoints},convert:function(e){return e.toFixed(1)}},winPercentage:{name:"Win %",className:"rating",value:function(e){return 0===e.played?-1:100*e.score/e.played},convert:function(e){return e<0?"-":e.toFixed()}},performanceRating:{name:"Perf",className:"rating",value:function(e){return e.performanceRating},convert:function(e){return e.toFixed()},show:function(e,t,n){return n.showRatings}},ratingDifference:{name:"P. +/-",className:"rating",value:function(e){return e.performanceRating?e.performanceRating-e.rating:0},convert:function(e){return e?e>0?"+"+e.toString():e.toString():""},show:function(e,t,n){return n.showRatings}},expectedScore:{name:"Expected",className:"rating",value:function(e){return e.expectedScore},convert:function(e,t){return e.toFixed(1)+" / "+t.played},show:function(e,t,n){return n.showRatings}},expectedDifference:{name:"E. +/-",className:"rating",value:function(e){return e.score-e.expectedScore},convert:function(e){return"undefined"===typeof e?"":e>0?"+"+e.toFixed(2):e.toFixed(2)},show:function(e,t,n){return n.showRatings}}}};function A(e){var t=Object(a.useMemo)((function(){return e.status.round>e.settings.totalRounds||"Infinity"===e.settings.totalRounds?e.status.round:e.settings.totalRounds}),[e.status.round,e.settings.totalRounds]),n=Object(a.useMemo)((function(){for(var e=[],n=1;n<=t;n++)e.push("round."+n.toString());return e}),[t]),c=Object(a.useMemo)((function(){return[].concat(Object(I.a)(Object.keys(q.pre)),Object(I.a)(n),Object(I.a)(Object.keys(q.post)))}),[n]).filter((function(t,n){var a=q.pre[t]||q.post[t];return!a||!(a.show&&!a.show(null,n,e.settings))})),s=Object(a.useCallback)((function(e,t){return c.includes(t)?e[0]!==t?[t,0]:[t,e[1]+1]:["",0]}),[c]),o=Object(a.useReducer)(s,["score",0]),u=Object(l.a)(o,2),i=u[0],m=u[1],d=Object(a.useCallback)((function(n){for(var a=[""],r=1;r<=t;r++)n.histories[r]?(null===n.histories[r].match||void 0===n.histories[r].match?a[r]="*":a[r]=n.histories[r].match.toString(),"bye"===n.histories[r].id&&(a[r]+="b")):r===e.status.round?a[r]="*":a[r]="";return a.slice(1)}),[t,e.status.round]),f=Object(a.useMemo)((function(){for(var t=[],n=function(n){var a=e.players[n];if("bye"===a.id)return"continue";void 0===a.score&&console.trace();for(var r=[],c=0,s=Object.entries(q.pre);c<s.length;c++){var o=Object(l.a)(s[c],2),u=(o[0],o[1]);u.show&&!u.show(a,n,e.settings)||r.push([u.value(a,n,e.settings),u,a])}for(var i=d(a).map((function(e){return[e,q.roundColumn,a]})),m=[],f=0,b=Object.entries(q.post);f<b.length;f++){var h=Object(l.a)(b[f],2),p=(h[0],h[1]);p.show&&!p.show(a,n,e.settings)||m.push([p.value(a,n,e.settings),p,a])}var v=[].concat(r,Object(I.a)(i),m);t.push(v)},a=0;a<e.players.length;a++)n(a);var s=function(e,t){return t-e},o=i[0].startsWith("round")?q.roundColumn:q.pre[i[0]]||q.post[i[0]];if(o&&!1!==o.sort){o.sort&&(s=o.sort);var u=c.indexOf(i[0]);-1!==u&&(t=t.sort((function(e,t){return i[1]%2?s(t[u][0],e[u][0]):s(e[u][0],t[u][0])})))}return t.map((function(t,n){return r.a.createElement("tr",{key:"row."+n,className:U.a.tr},t.map((function(t,a){var c=Object(l.a)(t,3),s=c[0],o=c[1],u=c[2],i=s?s.toString():"";o.convert?i=o.convert(s,u,e.settings):o.postConvert&&(i=o.postConvert(i,n)),"undefined"!==typeof i&&""!==i||(i="\u200b");var m="function"===typeof o.className?o.className(i,a,e.settings):o.className;return r.a.createElement("th",null,r.a.createElement("div",{id:o.id?o.id(u,a):void 0,key:[s,a].join("."),className:[U.a.cell,m,U.a[m]].join(" ")},i))})))}))}),[e.players,e.settings,d,i]);return r.a.createElement("section",null,r.a.createElement("table",{className:["download-table full-width",U.a.table].join(" ")},r.a.createElement("thead",null,r.a.createElement("tr",null,c.map((function(e,t){var n=e.startsWith("round")?q.roundColumn:q.pre[e]||q.post[e];return r.a.createElement("th",{scope:"column",key:["column",t].join("."),className:[U.a.th,e.startsWith("round")?U.a.round:""].join(" "),id:e,onClick:function(){return m(e)}},r.a.createElement("div",{className:[U.a.cell,U.a.headerCell].join(" ")},"function"===typeof n.name?n.name(e,t):n.name))})))),r.a.createElement("tbody",null,f)))}function J(e){var t=e.match.params.id,n=Object(a.useState)(!1),c=Object(l.a)(n,2),s=c[0],o=c[1],u=Object(a.useState)({}),m=Object(l.a)(u,2),d=(m[0],m[1],Object(a.useState)({})),f=Object(l.a)(d,2),b=f[0],h=f[1],v=Object(a.useState)({}),g=Object(l.a)(v,2),w=g[0],E=g[1],j=Object(a.useState)([]),O=Object(l.a)(j,2),y=O[0],k=O[1],N=Object(a.useState)([]),x=Object(l.a)(N,2),_=x[0],S=x[1],R=Object(a.useMemo)((function(){if(!y.length)return new Map;var e,t=new Map,n=Object(i.a)(y);try{for(n.s();!(e=n.n()).done;){var a=e.value;t.set(a.id,a)}}catch(r){n.e(r)}finally{n.f()}return t}),[y]),C=w.round||0;Object(a.useEffect)((function(){Promise.all([p({url:"/tournament/"+t+"/fetchPlayers"}).then(k).catch((function(){})),p({url:"/tournament/"+t+"/getPairings"}).then(S).catch((function(){})),p({url:"/tournament/"+t+"/getStatus"}).then(E).catch((function(){})),p({url:"/tournament/"+t+"/getSettings"}).then(h)]).then((function(){return o(!0)}))}),[S,k]),Object(a.useEffect)((function(){if(C){for(var e=new Array(C+1),t=1;t<C+1;t++)e[t]={match:0,game:0};R.set("bye",{id:"bye",firstName:"BYE",histories:e})}}),[R,C]);var L=["pairings","standings"],P=Object(a.useState)("pairings"),W=Object(l.a)(P,2),M=W[0],D=W[1];return Object(a.useEffect)((function(){var e=window.location.hash.slice(1);L.includes(e)&&D(e)}),[window.location.hash]),s?r.a.createElement("div",{id:"main"},r.a.createElement("div",{className:"container"},r.a.createElement("h1",null,w.name),r.a.createElement("section",null,r.a.createElement("div",{className:"button-list"},r.a.createElement("a",{href:"#pairings",className:"header-button"},r.a.createElement("h2",null,"Pairings")),r.a.createElement("a",{href:"#standings",className:"header-button"},r.a.createElement("h2",null,"Standings")))),r.a.createElement("section",null,"pairings"===M?r.a.createElement(F,{id:e.match.params.id,playerDict:R,status:w,pairings:_}):null,"standings"===M?r.a.createElement(A,{setDisplayPlayer:function(){},show:function(){},status:w,players:Array.from(R.values()),settings:b}):null))):null}var Y=function(){return r.a.createElement(o.a,{basename:""},r.a.createElement(u.a,{render:function(e){var t=e.location;return r.a.createElement(u.c,{location:t},r.a.createElement(u.a,{exact:!0,path:"/tournament/:id/",render:function(e){return r.a.createElement(J,e)}}))}}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Y,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[48,1,2]]]);
//# sourceMappingURL=main.94ed72ad.chunk.js.map